<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workflow Trigger - GitHub Pages</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f6f8fa;
            color: #24292f;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #0969da;
            text-align: center;
            margin-bottom: 10px;
        }
        .subtitle {
            text-align: center;
            color: #656d76;
            margin-bottom: 40px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }
        input[type="text"], select, textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d0d7de;
            border-radius: 6px;
            font-size: 14px;
            box-sizing: border-box;
        }
        textarea {
            resize: vertical;
            min-height: 80px;
        }
        .btn {
            background-color: #2da44e;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: background-color 0.2s;
            width: 100%;
            margin-top: 10px;
        }
        .btn:hover {
            background-color: #2c974b;
        }
        .btn:disabled {
            background-color: #94d3a2;
            cursor: not-allowed;
        }
        .status {
            margin-top: 20px;
            padding: 12px;
            border-radius: 6px;
            display: none;
        }
        .status.success {
            background-color: #dafbe1;
            color: #0969da;
            border: 1px solid #2da44e;
        }
        .status.error {
            background-color: #ffebe9;
            color: #cf222e;
            border: 1px solid #ff818266;
        }
        .info-box {
            background-color: #ddf4ff;
            border: 1px solid #54aeff66;
            border-radius: 6px;
            padding: 16px;
            margin-bottom: 30px;
        }

        .links {
            margin-top: 30px;
            text-align: center;
        }
        .links a {
            color: #0969da;
            text-decoration: none;
            margin: 0 10px;
        }
        .links a:hover {
            text-decoration: underline;
        }
        
        /* Copy button styling */
        #copyJsonBtn:hover {
            background: #0860ca !important;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        #copyJsonBtn:active {
            transform: translateY(0);
        }
        
        #copyJsonBtn {
            transition: all 0.2s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Workflows</h1>
        <p class="subtitle">Trigger GitHub Actions workflows from your browser</p>
        
        <!-- Workflow Pattern Selector -->
        <div class="workflow-selector" style="margin-bottom: 30px;">
            <h3 style="color: #07284f; margin-bottom: 15px;">üéØ Select workflow to run</h3>
            
            <div class="pattern-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; margin-bottom: 20px;">
                
                <!-- Advanced JSON Pattern -->
                <div class="pattern-card" data-pattern="advanced" style="border: 2px solid #d0d7de; border-radius: 8px; padding: 15px; cursor: pointer; transition: all 0.2s;">
                    <h4 style="margin: 0 0 8px 0; color: #0969da;">üîß Advanced JSON Configuration</h4>
                    <p style="margin: 0 0 8px 0; font-size: 14px; color: #656d76;">15+ inputs via JSON payload. Ideal for complex deployments.</p>
                    <div style="font-size: 12px; color: #0969da;">
                        <strong>Use cases:</strong> Multi-cloud deployments, complex CI/CD, enterprise configs
                    </div>
                </div>

                <!-- Simple Trigger Pattern -->
                <div class="pattern-card" data-pattern="simple" style="border: 2px solid #d0d7de; border-radius: 8px; padding: 15px; cursor: pointer; transition: all 0.2s;">
                    <h4 style="margin: 0 0 8px 0; color: #0969da;">‚ö° Simple Workflow Trigger</h4>
                    <p style="margin: 0 0 8px 0; font-size: 14px; color: #656d76;">Basic workflow with message and environment selection.</p>
                    <div style="font-size: 12px; color: #0969da;">
                        <strong>Use cases:</strong> Quick deployments, testing, demos, simple automation
                    </div>
                </div>

                <!-- Multi-Environment Pattern -->
                <div class="pattern-card" data-pattern="multi-env" style="border: 2px solid #d0d7de; border-radius: 8px; padding: 15px; cursor: pointer; transition: all 0.2s;">
                    <h4 style="margin: 0 0 8px 0; color: #0969da;">üåç Multi-Environment Pipeline</h4>
                    <p style="margin: 0 0 8px 0; font-size: 14px; color: #656d76;">Deploy across multiple environments with approval gates.</p>
                    <div style="font-size: 12px; color: #0969da;">
                        <strong>Use cases:</strong> Progressive deployments, staging pipelines, release management
                    </div>
                </div>

                <!-- API Integration Pattern -->
                <div class="pattern-card" data-pattern="api-integration" style="border: 2px solid #d0d7de; border-radius: 8px; padding: 15px; cursor: pointer; transition: all 0.2s;">
                    <h4 style="margin: 0 0 8px 0; color: #0969da;">üîó API Integration Workflow</h4>
                    <p style="margin: 0 0 8px 0; font-size: 14px; color: #656d76;">Fetch data from external APIs and trigger based on results.</p>
                    <div style="font-size: 12px; color: #0969da;">
                        <strong>Use cases:</strong> Nexus artifacts, Docker registry, infrastructure APIs
                    </div>
                </div>
                
            </div>
            
        </div>

        <!-- Advanced Configuration Form (11+ Inputs) -->
        <form id="triggerForm">
            <h3>üéØ Advanced Workflow Configuration</h3>
            
            <!-- Deployment Configuration -->
            <fieldset style="margin-bottom: 20px; padding: 15px; border: 1px solid #d0d7de; border-radius: 6px;">
                <legend style="font-weight: bold; color: #0969da;">üöÄ Deployment Settings</legend>
                
                <div class="form-group">
                    <label for="environment">Target Environment:</label>
                    <select id="environment" name="environment" required>
                        <option value="development">Development</option>
                        <option value="staging">Staging</option>
                        <option value="production">Production</option>
                        <option value="qa">QA</option>
                        <option value="integration">Integration</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="region">Deployment Region:</label>
                    <select id="region" name="region" required>
                        <option value="us-east-1">US East (N. Virginia)</option>
                        <option value="us-west-2">US West (Oregon)</option>
                        <option value="eu-west-1">Europe (Ireland)</option>
                        <option value="ap-southeast-1">Asia Pacific (Singapore)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="version">Application Version:</label>
                    <input type="text" id="version" name="version" placeholder="v1.2.3 or latest" required>
                </div>
                
                <div class="form-group">
                    <label for="replicas">Replica Count:</label>
                    <input type="number" id="replicas" name="replicas" min="1" max="10" value="3" required>
                </div>
            </fieldset>

            <!-- Application Configuration -->
            <fieldset style="margin-bottom: 20px; padding: 15px; border: 1px solid #d0d7de; border-radius: 6px;">
                <legend style="font-weight: bold; color: #0969da;">‚öôÔ∏è Application Settings</legend>
                
                <div class="form-group">
                    <label for="appName">Application Name:</label>
                    <input type="text" id="appName" name="appName" placeholder="my-application" required>
                </div>
                
                <div class="form-group">
                    <label for="namespace">Kubernetes Namespace:</label>
                    <input type="text" id="namespace" name="namespace" placeholder="default" required>
                </div>
                
                <div class="form-group">
                    <label for="dockerImage">Docker Image:</label>
                    <input type="text" id="dockerImage" name="dockerImage" placeholder="nginx:latest" required>
                </div>
                
                <div class="form-group">
                    <label for="resources">Resource Limits:</label>
                    <select id="resources" name="resources" required>
                        <option value="small">Small (0.5 CPU, 512Mi RAM)</option>
                        <option value="medium">Medium (1 CPU, 1Gi RAM)</option>
                        <option value="large">Large (2 CPU, 2Gi RAM)</option>
                        <option value="xlarge">XLarge (4 CPU, 4Gi RAM)</option>
                    </select>
                </div>
            </fieldset>

            <!-- Database Configuration -->
            <fieldset style="margin-bottom: 20px; padding: 15px; border: 1px solid #d0d7de; border-radius: 6px;">
                <legend style="font-weight: bold; color: #0969da;">üóÑÔ∏è Database Settings</legend>
                
                <div class="form-group">
                    <label for="dbType">Database Type:</label>
                    <select id="dbType" name="dbType" required>
                        <option value="postgresql">PostgreSQL</option>
                        <option value="mysql">MySQL</option>
                        <option value="mongodb">MongoDB</option>
                        <option value="redis">Redis</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="dbVersion">Database Version:</label>
                    <input type="text" id="dbVersion" name="dbVersion" placeholder="13.4" required>
                </div>
                
                <div class="form-group">
                    <label for="dbSize">Database Size:</label>
                    <select id="dbSize" name="dbSize" required>
                        <option value="10Gi">Small (10GB)</option>
                        <option value="50Gi">Medium (50GB)</option>
                        <option value="100Gi">Large (100GB)</option>
                        <option value="500Gi">XLarge (500GB)</option>
                    </select>
                </div>
            </fieldset>

            <!-- Advanced Options -->
            <fieldset style="margin-bottom: 20px; padding: 15px; border: 1px solid #d0d7de; border-radius: 6px;">
                <legend style="font-weight: bold; color: #0969da;">üîß Advanced Options</legend>
                
                <div class="form-group">
                    <label for="enableLogging">
                        <input type="checkbox" id="enableLogging" name="enableLogging" checked style="width: auto; margin-right: 8px;">
                        Enable Enhanced Logging
                    </label>
                </div>
                
                <div class="form-group">
                    <label for="enableMonitoring">
                        <input type="checkbox" id="enableMonitoring" name="enableMonitoring" checked style="width: auto; margin-right: 8px;">
                        Enable Monitoring & Alerting
                    </label>
                </div>
            
                <div class="form-group">
                    <label for="deploymentNotes">Deployment Notes:</label>
                    <textarea id="deploymentNotes" name="deploymentNotes" placeholder="Enter any special notes for this deployment..." rows="3"></textarea>
                </div>
            </fieldset>

            <!-- Generated JSON Preview -->
            <fieldset style="margin-bottom: 20px; padding: 15px; border: 1px solid #f0c040; border-radius: 6px; background-color: #fff8dc;">
                <legend style="font-weight: bold; color: #b8860b;">üìã Generated Configuration JSON</legend>
                <div style="position: relative;">
                    <pre id="jsonPreview" style="background: #f6f8fa; padding: 10px; border-radius: 4px; overflow-x: auto; font-size: 12px; max-height: 200px; margin: 0;">{
  "deployment": {},
  "application": {},
  "database": {},
  "advanced": {}
}</pre>
                    <button id="copyJsonBtn" onclick="copyJsonToClipboard()" style="position: absolute; top: 8px; right: 8px; background: #0969da; color: white; border: none; padding: 6px 8px; border-radius: 4px; cursor: pointer; font-size: 12px; display: flex; align-items: center; gap: 4px;" title="Copy JSON to clipboard">
                        <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
                            <path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path>
                            <path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path>
                        </svg>
                        Copy
                    </button>
                </div>
            </fieldset>

            <button type="submit" class="btn" id="triggerBtn">
                üéØ Generate JSON & Trigger Advanced Workflow
            </button>
        </form>

        <div id="status" class="status"></div>

        <div class="links" id="dynamic-links">
            <!-- Links will be populated dynamically by JavaScript -->
        </div>
    </div>

    <script>
        // Auto-detect repository information from GitHub Pages URL
        function getRepoInfo() {
            const hostname = window.location.hostname;
            const pathname = window.location.pathname;
            
            if (hostname.endsWith('.github.io')) {
                // GitHub Pages URL format: username.github.io/repository
                const owner = hostname.split('.')[0];
                const repo = pathname.split('/')[1] || owner; // If no repo in path, assume it's username.github.io (same as username)
                return { owner, repo };
            } else if (hostname === 'localhost' || hostname.startsWith('127.0.0.1') || hostname.startsWith('file://')) {
                // Local development - use fallback values
                return { 
                    owner: 'ElizabethMoralesO', 
                    repo: 'test' 
                };
            } else {
                // Custom domain - try to extract from pathname or use defaults
                const pathParts = pathname.split('/').filter(Boolean);
                return { 
                    owner: pathParts[0] || 'ElizabethMoralesO', 
                    repo: pathParts[1] || 'test' 
                };
            }
        }
        
        const { owner: REPO_OWNER, repo: REPO_NAME } = getRepoInfo();
        console.log(`üîç Auto-detected repository: ${REPO_OWNER}/${REPO_NAME}`);
        
        // Initialize page with auto-detected repository info
        function initializePage() {
            // Update repository display
            const repoNameElement = document.getElementById('repo-name');
            if (repoNameElement) {
                repoNameElement.textContent = `${REPO_OWNER}/${REPO_NAME}`;
                repoNameElement.style.fontFamily = 'monospace';
                repoNameElement.style.background = '#f6f8fa';
                repoNameElement.style.padding = '2px 6px';
                repoNameElement.style.borderRadius = '3px';
                repoNameElement.style.fontSize = '14px';
            }
            
            // Update dynamic links
            const linksContainer = document.getElementById('dynamic-links');
            if (linksContainer) {
                linksContainer.innerHTML = `
                    <a href="https://github.com/${REPO_OWNER}/${REPO_NAME}/actions" target="_blank">üìä View Workflow Runs</a>
                    <a href="https://github.com/${REPO_OWNER}/${REPO_NAME}" target="_blank">üìÅ View Repository</a>
                    <a href="https://github.com/${REPO_OWNER}/${REPO_NAME}/tree/main/.github/workflows" target="_blank">‚öôÔ∏è View All Workflows</a>
                `;
            }
            
            // Select default pattern
            selectPattern('advanced');
        }
        
        // Call initialization when page loads
        document.addEventListener('DOMContentLoaded', initializePage);
        
        // Available workflow patterns
        const WORKFLOW_PATTERNS = {
            'advanced': {
                name: 'Advanced JSON Configuration',
                workflow: 'advanced-workflow.yaml',
                description: 'Complex deployment configuration with 15+ inputs via JSON payload'
            },
            'simple': {
                name: 'Simple Workflow Trigger',
                workflow: 'simple-workflow.yaml',
                description: 'Basic workflow trigger with message and environment selection'
            },
            'multi-env': {
                name: 'Multi-Environment Pipeline',
                workflow: 'multi-env-workflow.yaml',
                description: 'Progressive deployment across multiple environments with approval gates'
            },
            'api-integration': {
                name: 'API Integration Workflow',
                workflow: 'api-integration-workflow.yaml',
                description: 'Fetch external data and trigger workflows based on API responses'
            }
        };
        
        let selectedPattern = 'advanced'; // Default pattern

        // Setup event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Pattern selection
            const patternCards = document.querySelectorAll('.pattern-card');
            patternCards.forEach(card => {
                card.addEventListener('click', () => selectPattern(card.dataset.pattern));
            });
            
            // Form submission
            document.getElementById('triggerForm').addEventListener('submit', handleWorkflowTrigger);
            
            // Add real-time JSON preview updates for advanced pattern
            const formInputs = document.querySelectorAll('#triggerForm input, #triggerForm select, #triggerForm textarea');
            formInputs.forEach(input => {
                input.addEventListener('input', updateDisplay);
                input.addEventListener('change', updateDisplay);
            });
            
            // Initialize with default pattern
            selectPattern(selectedPattern);
        });

        // Select workflow pattern
        function selectPattern(patternId) {
            selectedPattern = patternId;
            const pattern = WORKFLOW_PATTERNS[patternId];
            
            // Update visual selection
            document.querySelectorAll('.pattern-card').forEach(card => {
                if (card.dataset.pattern === patternId) {
                    card.style.border = '2px solid #2da44e';
                    card.style.backgroundColor = '#dafbe1';
                } else {
                    card.style.border = '2px solid #d0d7de';
                    card.style.backgroundColor = 'white';
                }
            });
            
            // Show selected pattern info
            document.getElementById('selected-pattern-info').style.display = 'block';
            document.getElementById('selected-pattern-name').textContent = pattern.name;
            document.getElementById('selected-pattern-description').textContent = pattern.description;
            
            // Show appropriate form
            showFormForPattern(patternId);
        }

        // Show appropriate form based on pattern
        function showFormForPattern(patternId) {
            const formContainer = document.getElementById('triggerForm');
            
            if (patternId === 'advanced') {
                // Advanced form is already in HTML, just make sure it's visible
                showAdvancedForm();
            } else if (patternId === 'simple') {
                // Simple workflow - redirect directly to GitHub Actions
                redirectToSimpleWorkflow();
            } else if (patternId === 'multi-env') {
                showMultiEnvForm();
            } else if (patternId === 'api-integration') {
                showApiIntegrationForm();
            }
            
            // Update display after form change
            updateDisplay();
        }

        // Update JSON preview in real-time
        function updateJSONPreview() {
            const config = collectFormData();
            const jsonPreview = document.getElementById('jsonPreview');
            jsonPreview.textContent = JSON.stringify(config, null, 2);
        }

        // Collect all form data into structured JSON
        function collectFormData() {
            return {
                deployment: {
                    environment: document.getElementById('environment').value,
                    region: document.getElementById('region').value,
                    version: document.getElementById('version').value,
                    replicas: parseInt(document.getElementById('replicas').value) || 3
                },
                application: {
                    name: document.getElementById('appName').value,
                    namespace: document.getElementById('namespace').value,
                    dockerImage: document.getElementById('dockerImage').value,
                    resources: document.getElementById('resources').value
                },
                database: {
                    type: document.getElementById('dbType').value,
                    version: document.getElementById('dbVersion').value,
                    size: document.getElementById('dbSize').value
                },
                advanced: {
                    enableLogging: document.getElementById('enableLogging').checked,
                    enableMonitoring: document.getElementById('enableMonitoring').checked,
                    customEnvVars: parseJSON(document.getElementById('customEnvVars').value),
                    deploymentNotes: document.getElementById('deploymentNotes').value
                },
                metadata: {
                    timestamp: new Date().toISOString(),
                    triggeredBy: 'github-pages',
                    formVersion: '1.0',
                    totalInputs: 15 // Demonstrating 15 inputs vs GitHub's 10 limit
                }
            };
        }

        // Safely parse JSON with fallback
        function parseJSON(str) {
            if (!str.trim()) return {};
            try {
                return JSON.parse(str);
            } catch (e) {
                return { error: 'Invalid JSON format' };
            }
        }

        // Show different forms based on pattern
        function showAdvancedForm() {
            // Advanced form is already in HTML - this function ensures it's properly displayed
            updateJSONPreview();
        }

        function showSimpleForm() {
            const formContainer = document.getElementById('triggerForm');
            formContainer.innerHTML = `
                <h3>‚ö° Simple Workflow Trigger</h3>
                <div class="form-group">
                    <label for="simple-message">Message:</label>
                    <textarea id="simple-message" placeholder="Enter a message for the workflow...">Hello from Simple Trigger! üëã</textarea>
                </div>
                <div class="form-group">
                    <label for="simple-environment">Environment:</label>
                    <select id="simple-environment">
                        <option value="development">Development</option>
                        <option value="staging">Staging</option>
                        <option value="production">Production</option>
                    </select>
                </div>
                <button type="submit" class="btn" id="triggerBtn">
                    ‚ö° Trigger Simple Workflow
                </button>
            `;
        }

        function showMultiEnvForm() {
            const formContainer = document.getElementById('triggerForm');
            formContainer.innerHTML = `
                <h3>üåç Multi-Environment Pipeline</h3>
                <div class="form-group">
                    <label for="release-version">Release Version:</label>
                    <input type="text" id="release-version" placeholder="v1.0.0" required>
                </div>
                <div class="form-group">
                    <label for="source-environment">Source Environment:</label>
                    <select id="source-environment" required>
                        <option value="development">Development</option>
                        <option value="staging">Staging</option>
                        <option value="production">Production</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="target-environments">Target Environments:</label>
                    <div style="margin: 8px 0;">
                        <label><input type="checkbox" value="qa" style="width: auto; margin-right: 8px;"> QA Environment</label><br>
                        <label><input type="checkbox" value="staging" style="width: auto; margin-right: 8px;"> Staging Environment</label><br>
                        <label><input type="checkbox" value="production" style="width: auto; margin-right: 8px;"> Production Environment</label>
                    </div>
                </div>
                <div class="form-group">
                    <label for="approval-required">
                        <input type="checkbox" id="approval-required" style="width: auto; margin-right: 8px;">
                        Require Manual Approval for Production
                    </label>
                </div>
                <div class="form-group">
                    <label for="rollback-strategy">Rollback Strategy:</label>
                    <select id="rollback-strategy">
                        <option value="automatic">Automatic on Failure</option>
                        <option value="manual">Manual Only</option>
                        <option value="none">No Rollback</option>
                    </select>
                </div>
                <button type="submit" class="btn" id="triggerBtn">
                    üåç Start Multi-Environment Pipeline
                </button>
            `;
        }

        function showApiIntegrationForm() {
            const formContainer = document.getElementById('triggerForm');
            formContainer.innerHTML = `
                <h3>üîó API Integration Workflow</h3>
                <div class="form-group">
                    <label for="api-source">API Source:</label>
                    <select id="api-source" required>
                        <option value="nexus">Nexus Repository</option>
                        <option value="docker-hub">Docker Hub</option>
                        <option value="github-releases">GitHub Releases</option>
                        <option value="custom-api">Custom API</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="api-endpoint">API Endpoint:</label>
                    <input type="text" id="api-endpoint" placeholder="https://api.example.com/artifacts" required>
                </div>
                <div class="form-group">
                    <label for="filter-criteria">Filter Criteria:</label>
                    <input type="text" id="filter-criteria" placeholder="latest, stable, v1.*">
                </div>
                <div class="form-group">
                    <label for="action-on-result">Action on API Result:</label>
                    <select id="action-on-result" required>
                        <option value="deploy-latest">Deploy Latest Version</option>
                        <option value="compare-versions">Compare with Current</option>
                        <option value="notify-only">Notification Only</option>
                        <option value="conditional-deploy">Conditional Deployment</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="webhook-url">Notification Webhook (Optional):</label>
                    <input type="url" id="webhook-url" placeholder="https://hooks.slack.com/...">
                </div>
                <button type="submit" class="btn" id="triggerBtn">
                    üîó Start API Integration Workflow
                </button>
            `;
        }

        // Update display based on selected pattern
        function updateDisplay() {
            if (selectedPattern === 'advanced') {
                updateJSONPreview();
            }
            // Other patterns don't need real-time preview updates
        }

        // Handle workflow trigger
        async function handleWorkflowTrigger(e) {
            e.preventDefault();
            
            const triggerBtn = document.getElementById('triggerBtn');
            const pattern = WORKFLOW_PATTERNS[selectedPattern];
            
            // Reset status and disable button
            hideMessage();
            triggerBtn.disabled = true;
            
            if (selectedPattern === 'advanced') {
                const config = collectFormData();
                
                // Validate required fields
                if (!config.application.name || !config.deployment.version) {
                    showMessage('error', '‚ùå Please fill in all required fields (Application Name, Version)');
                    triggerBtn.disabled = false;
                    return;
                }
                
                triggerBtn.textContent = 'üîÑ Generating JSON payload...';
                redirectToGitHubActions(config, pattern.workflow);
                
            } else if (selectedPattern === 'simple') {
                triggerBtn.textContent = 'üîÑ Triggering simple workflow...';
                const message = document.getElementById('simple-message').value;
                const environment = document.getElementById('simple-environment').value;
                redirectToSimpleWorkflowWithParams(message, environment, pattern.workflow);
                
            } else if (selectedPattern === 'multi-env') {
                triggerBtn.textContent = 'üîÑ Starting pipeline...';
                const config = collectMultiEnvData();
                redirectToMultiEnvWorkflow(config, pattern.workflow);
                
            } else if (selectedPattern === 'api-integration') {
                triggerBtn.textContent = 'üîÑ Configuring API integration...';
                const config = collectApiIntegrationData();
                redirectToApiIntegrationWorkflow(config, pattern.workflow);
            }
            
            // Re-enable button after delay
            setTimeout(() => {
                triggerBtn.disabled = false;
                const originalText = triggerBtn.textContent.replace('üîÑ ', 'üéØ ').replace('...', '');
                triggerBtn.textContent = originalText;
            }, 3000);
        }

        // Direct user to GitHub Actions page to trigger workflow with JSON payload
        function redirectToGitHubActions(config) {
            // Create the GitHub Actions trigger URL
            const actionsUrl = `https://github.com/${REPO_OWNER}/${REPO_NAME}/actions/workflows/advanced-workflow.yaml`;
            
            // Create a compact JSON string for display
            const jsonPayload = JSON.stringify(config, null, 2);
            
            showMessage('success', `
                üéØ <strong>Advanced Configuration Ready!</strong><br><br>
                <strong>Configuration Summary:</strong><br>
                ÔøΩ App: ${config.application.name} (${config.application.dockerImage})<br>
                üåç Environment: ${config.deployment.environment} (${config.deployment.region})<br>
                üóÑÔ∏è Database: ${config.database.type} ${config.database.version}<br>
                ‚öñÔ∏è Scale: ${config.deployment.replicas} replicas (${config.application.resources})<br>
                üìä Total Inputs: ${config.metadata.totalInputs} (exceeds GitHub's 10-input limit!)<br><br>
                
                <a href="${actionsUrl}" target="_blank" class="btn" style="color: white; text-decoration: none; display: inline-block; margin: 10px 0;">
                    üöÄ Trigger Advanced Workflow in GitHub Actions
                </a><br>
                
                <small>
                <div style="background: #d1ecf1; border: 1px solid #bee5eb; border-radius: 4px; padding: 8px; margin: 8px 0; text-align: center;">
                    üìã <strong>JSON Already Copied to Clipboard!</strong><br>
                    <small>Just paste (Ctrl+V) when GitHub opens</small>
                </div>
                <strong>Super Simple Steps:</strong><br>
                1. ‚úÖ JSON is already copied to your clipboard<br>
                2. üöÄ Click button above to open GitHub Actions<br>
                3. ‚ñ∂Ô∏è Click "Run workflow" button<br>
                4. üìã Paste (Ctrl+V) in the JSON Configuration field<br>
                5. üéØ Click "Run workflow" to start!
                </small>
            `);
            
            // Copy JSON to clipboard for easy pasting
            navigator.clipboard.writeText(jsonPayload).then(() => {
                console.log('‚úÖ JSON configuration copied to clipboard');
                // Update button text temporarily to show copy success
                triggerBtn.textContent = 'üìã JSON Copied! Opening GitHub...';
                triggerBtn.style.background = '#2da44e';
            }).catch(err => {
                console.log('Could not copy to clipboard:', err);
                // Fallback copy method
                const textArea = document.createElement('textarea');
                textArea.value = jsonPayload;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                
                triggerBtn.textContent = 'üìã JSON Copied! Opening GitHub...';
                triggerBtn.style.background = '#2da44e';
            });
            
            // Auto-open GitHub Actions page
            setTimeout(() => {
                window.open(actionsUrl, '_blank');
            }, 3000);
        }

        // Collect data for multi-environment workflow
        function collectMultiEnvData() {
            const targets = [];
            document.querySelectorAll('input[type="checkbox"][value]').forEach(cb => {
                if (cb.checked) targets.push(cb.value);
            });
            
            return {
                release_version: document.getElementById('release-version').value,
                source_environment: document.getElementById('source-environment').value,
                target_environments: targets.join(','),
                approval_required: document.getElementById('approval-required').checked,
                rollback_strategy: document.getElementById('rollback-strategy').value
            };
        }

        // Collect data for API integration workflow
        function collectApiIntegrationData() {
            return {
                api_source: document.getElementById('api-source').value,
                api_endpoint: document.getElementById('api-endpoint').value,
                filter_criteria: document.getElementById('filter-criteria').value || 'latest',
                action_on_result: document.getElementById('action-on-result').value,
                webhook_url: document.getElementById('webhook-url').value || ''
            };
        }

        // Direct redirect to simple workflow (no form needed)
        function redirectToSimpleWorkflow() {
            const pattern = WORKFLOW_PATTERNS['simple'];
            const dispatchUrl = `https://github.com/${REPO_OWNER}/${REPO_NAME}/actions/workflows/${pattern.workflow}`;
            
            showMessage('success', `
                üöÄ Redirecting to Simple Workflow!<br><br>
                <strong>Why no form?</strong><br>
                The simple workflow only has 2 basic inputs (message & environment) that are easier to fill directly in GitHub Actions.<br><br>
                You'll be redirected now...
            `);
            
            setTimeout(() => {
                window.open(dispatchUrl, '_blank');
            }, 1500);
        }

        // Redirect to simple workflow (with parameters - used by form submission)
        function redirectToSimpleWorkflowWithParams(message, environment, workflowFile) {
            const dispatchUrl = `https://github.com/${REPO_OWNER}/${REPO_NAME}/actions/workflows/${workflowFile}`;
            
            showMessage('success', `
                ‚úÖ Simple workflow ready to trigger!<br><br>
                <strong>Configuration:</strong><br>
                ‚Ä¢ Message: ${message}<br>
                ‚Ä¢ Environment: ${environment}<br><br>
                You'll be redirected to GitHub Actions to run the workflow...
            `);
            
            setTimeout(() => {
                window.open(dispatchUrl, '_blank');
            }, 2000);
        }

        // Redirect to multi-environment workflow
        function redirectToMultiEnvWorkflow(config, workflowFile) {
            const dispatchUrl = `https://github.com/${REPO_OWNER}/${REPO_NAME}/actions/workflows/${workflowFile}`;
            
            showMessage('success', `
                ‚úÖ Multi-environment pipeline configured!<br><br>
                <strong>Configuration:</strong><br>
                ‚Ä¢ Release: ${config.release_version}<br>
                ‚Ä¢ From: ${config.source_environment}<br>
                ‚Ä¢ To: ${config.target_environments || 'None selected'}<br>
                ‚Ä¢ Approval Required: ${config.approval_required ? 'Yes' : 'No'}<br><br>
                You'll be redirected to GitHub Actions...
            `);
            
            setTimeout(() => {
                window.open(dispatchUrl, '_blank');
            }, 2000);
        }

        // Redirect to API integration workflow
        function redirectToApiIntegrationWorkflow(config, workflowFile) {
            const dispatchUrl = `https://github.com/${REPO_OWNER}/${REPO_NAME}/actions/workflows/${workflowFile}`;
            
            showMessage('success', `
                ‚úÖ API integration workflow configured!<br><br>
                <strong>Configuration:</strong><br>
                ‚Ä¢ API Source: ${config.api_source}<br>
                ‚Ä¢ Endpoint: ${config.api_endpoint}<br>
                ‚Ä¢ Action: ${config.action_on_result}<br><br>
                You'll be redirected to GitHub Actions...
            `);
            
            setTimeout(() => {
                window.open(dispatchUrl, '_blank');
            }, 2000);
        }

        // Utility functions
        function showMessage(type, message) {
            const statusDiv = document.getElementById('status');
            statusDiv.className = `status ${type}`;
            statusDiv.innerHTML = message;
            statusDiv.style.display = 'block';
        }

        function hideMessage() {
            const statusDiv = document.getElementById('status');
            statusDiv.style.display = 'none';
        }

        // Copy JSON to clipboard with visual feedback
        function copyJsonToClipboard() {
            const jsonPreview = document.getElementById('jsonPreview');
            const copyBtn = document.getElementById('copyJsonBtn');
            const originalText = copyBtn.innerHTML;
            
            // Get the JSON text
            const jsonText = jsonPreview.textContent;
            
            // Copy to clipboard
            navigator.clipboard.writeText(jsonText).then(() => {
                // Success feedback
                copyBtn.innerHTML = `
                    <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
                        <path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path>
                    </svg>
                    Copied!
                `;
                copyBtn.style.background = '#2da44e';
                
                // Reset after 2 seconds
                setTimeout(() => {
                    copyBtn.innerHTML = originalText;
                    copyBtn.style.background = '#0969da';
                }, 2000);
                
                console.log('‚úÖ JSON configuration copied to clipboard');
            }).catch(err => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = jsonText;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                
                // Show feedback
                copyBtn.innerHTML = `
                    <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
                        <path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path>
                    </svg>
                    Copied!
                `;
                copyBtn.style.background = '#2da44e';
                
                setTimeout(() => {
                    copyBtn.innerHTML = originalText;
                    copyBtn.style.background = '#0969da';
                }, 2000);
                
                console.log('‚úÖ JSON configuration copied to clipboard (fallback method)');
            });
        }
    </script>
</body>
</html>